## 1.4 - Encryption Technologies

Trusted Platform Module (TPM)
â€¢ A specification for cryptographic functions
â€“ Cryptography hardware on a device
â€¢ Cryptographic processor
â€“ Random number generator, key generators
â€¢ Persistent memory
â€“ Unique keys burned in during manufacturing
â€¢ Versatile memory
â€“ Storage keys, hardware configuration information
â€“ Securely store BitLocker keys
â€¢ Password protected
â€“ No dictionary attacks

Hardware Security Module (HSM)
â€¢ Used in large environments
â€“ Clusters, redundant power
â€“ Securely store thousands of cryptographic keys
â€¢ High-end cryptographic hardware
â€“ Plug-in card or separate hardware device
â€¢ Key backup
â€“ Secure storage in hardware
â€¢ Cryptographic accelerators
â€“ OfÃ’oad that CPU overhead from other devices

_â€œIf BitLocker relies on TPM, and passwords can be brute-forced, how does TPM stop that?â€_

Letâ€™s break it down:

---

### ğŸ”‘ Where the password comes in

- In BitLocker, the **TPM stores the encryption key** (the actual secret to unlock the drive).
    
- Your **password/PIN** is just one layer of access control.
    
- The TPM wonâ€™t just hand out the key if someone keeps trying wrong passwords.
    

---

### ğŸ” How TPM defends against brute force

1. **Rate limiting**
    
    - TPM enforces delays after wrong attempts (like a phone lock).
        
    - Example: after 5 wrong tries â†’ wait 30 seconds, then 1 minute, then more.
        
    - This makes brute force attacks painfully slow.
        
2. **Lockout mechanism**
    
    - If too many wrong guesses are entered, TPM can go into **lockout mode**, refusing further attempts for a set period.
        
3. **Hardware isolation**
    
    - The decryption key never leaves the TPM.
        
    - An attacker canâ€™t just copy it out and try cracking it on a supercomputer.
        
    - The only way to test guesses is **through the TPM itself**, which enforces the above rules.
        

---

### âš¡ Example with BitLocker

- Without TPM: attacker could steal the key file and brute-force it offline at millions of guesses per second.
    
- With TPM: attacker must feed guesses _to the chip_, which only allows a handful per minute.
    
- Brute force goes from **days** â†’ to **thousands of years** impractical.
    

---

âœ… In short:

- TPM protects against brute force by **slowing down or blocking repeated guesses**.
    
- Thatâ€™s why even if someone has your laptop, they canâ€™t just run a fast brute-force on your BitLocker password.



### ğŸ”‘ **OS-based security (like NT Manager)**

- Runs **in software** on your operating system.
    
- Stores keys and credentials in memory or disk.
    
- If malware, rootkits, or attackers get admin/system-level access â†’ they can **read or steal** those keys.
    
- Basically: once the OS is compromised, your security is compromised.
    

---

### ğŸ” **TPM (hardware security)**

- Runs **outside the OS** â†’ in a separate hardware chip.
    
- Stores the most sensitive cryptographic keys **inside the chip**, never exposing them to the OS directly.
    
- Even if Windows (or Linux) is hacked, attackers **canâ€™t extract TPM-protected keys**, because the chip wonâ€™t reveal them.
    
- Provides **secure boot**: verifies that the system hasnâ€™t been tampered with before the OS loads.
    

---

ğŸ‘‰ **Why TPM is needed in addition to NT Manager:**

- **Software-only security** = easier to bypass if OS is hacked.
    
- **Hardware-backed security (TPM)** = attackers canâ€™t just copy or steal the keys because theyâ€™re tied to the chip.
    

---

ğŸ“ Easy analogy:

- NT Manager = a **lock on your house door** (software).
    
- TPM = a **safe bolted to the floor inside your house** (hardware). Even if burglars break in, they canâ€™t open the safe.


### **Trusted Platform Module (TPM)**

Think of **TPM** as a **tiny security chip** thatâ€™s soldered onto your computerâ€™s motherboard.

ğŸ”¹ What it does:

- **Cryptography hardware** â†’ Handles encryption/decryption.
    
- **Random number generator & key generator** â†’ Creates secure keys.
    
- **Persistent memory** â†’ Has a unique, unchangeable key burned in at the factory (like a fingerprint for your PC).
    
- **Versatile memory** â†’ Stores keys, security settings, and info like **BitLocker keys**.
    
- **Password protected** â†’ Designed so hackers canâ€™t brute-force it with dictionary attacks.
    

ğŸ‘‰ In short: **TPM is a small, built-in chip that keeps your PCâ€™s encryption keys safe.**

---

### **Hardware Security Module (HSM)**

Now think of **HSM** as a **super powerful TPM, but for companies**.

ğŸ”¹ What it does:

- **Used in large environments** â†’ Can handle thousands of keys for servers, banks, cloud systems.
    
- **High-end cryptographic hardware** â†’ Comes as a plug-in card or a separate box.
    
- **Key backup** â†’ Stores keys securely in hardware.
    
- **Cryptographic accelerators** â†’ Takes over encryption tasks so CPUs donâ€™t get overloaded.
    
- **Enterprise-grade** â†’ Redundant power, clusters, very secure.
    

ğŸ‘‰ In short: **HSM is a big, enterprise-grade security device that stores and protects tons of encryption keys.**

---

### ğŸ“ Easy way to remember:

- **TPM** â†’ A **personal security chip** for your PC.
    
- **HSM** â†’ A **giant secure vault** for companies that need to protect lots of keys.




Secure enclave
â€¢ A protected area for our secrets
â€“ Often implemented as a hardware processor
â€“ Isolated from the main processor
â€“ Many different technologies and names
â€¢ Provides extensive security features
â€“ Has its own boot ROM
â€“ Monitors the system boot process
â€“ True random number generator
â€“ Real-time memory encryption
â€“ Root cryptographic keys
â€“ Performs AES encryption in hardware
â€“ And moreâ€¦

### ğŸ”¹ What is a Secure Enclave?

Think of it as a **mini-computer inside your computer/phone** that only handles **secrets** (like encryption keys, passwords, or fingerprints).

- Itâ€™s a **separate processor** from the main CPU.
    
- Isolated â†’ the normal OS and apps **canâ€™t peek inside**.
    
- Used in devices like **Appleâ€™s Secure Enclave, Intel SGX, ARM TrustZone**.
    

---

### ğŸ” What it does

1. **Own boot ROM** â†’ It boots itself securely, making sure no tampering has happened.
    
2. **Monitors boot process** â†’ Checks that the main system starts correctly.
    
3. **Random number generator** â†’ Generates secure numbers for cryptography.
    
4. **Memory encryption** â†’ Keeps its memory encrypted in real-time, so attackers canâ€™t dump it.
    
5. **Root cryptographic keys** â†’ Stores â€œmaster keysâ€ that never leave the enclave.
    
6. **AES in hardware** â†’ Performs super-fast encryption/decryption directly in hardware.
    

---

### âœ… Easy analogy

- Main CPU = **your house** (runs apps, OS).
    
- Secure Enclave = **a locked safe room inside the house**.
    
    - Only it knows the combo.
        
    - Even if burglars break into the house (hack the OS), they **still canâ€™t get inside the safe room**.
        

---

### ğŸ“± Real-world examples

- **iPhone/Apple devices** â†’ Secure Enclave stores Touch ID/Face ID data & Apple Pay keys.
    
- **Intel SGX** â†’ Protects sensitive applications/data in a secure â€œenclaveâ€ even if OS is compromised.
    
- **ARM TrustZone** â†’ Used in Android phones for similar purposes.
    

---

ğŸ‘‰ In short:  
A **Secure Enclave** is like a **dedicated vault inside your device**, separate from the main CPU, built only to protect your most sensitive secrets.



### ğŸ” **TPM vs Secure Enclave**

|Feature|**TPM (Trusted Platform Module)**|**Secure Enclave**|
|---|---|---|
|**What it is**|A **separate security chip** soldered on motherboard|A **separate processor/area** inside the main CPU/SoC|
|**Main use**|Protects system integrity & encryption keys (e.g., BitLocker, Secure Boot)|Protects sensitive data like biometrics, payment info, app secrets|
|**Isolation**|Physically separate from CPU, communicates with OS|Logically isolated **inside** CPU/SoC, runs its own mini-OS|
|**Security focus**|System-wide security â†’ boot verification, disk encryption, authentication keys|Application/user security â†’ biometric data, Apple Pay, DRM, secure apps|
|**Keys**|Stores â€œroot keysâ€ for the **whole system**|Stores **per-device keys** for apps and users|
|**Examples**|BitLocker in Windows, Linux dm-crypt with TPM|Apple Secure Enclave (Touch ID/Face ID), Intel SGX, ARM TrustZone|
|**Who uses it**|Mostly PCs, laptops, servers|Mostly phones, tablets, some modern CPUs|

---

### âœ… Easy way to remember:

- **TPM** = A **hardware vault for the computer itself** (protects boot process, disk, OS).
    
- **Secure Enclave** = A **personal vault inside the CPU** (protects your fingerprints, Face ID, payments, app secrets).
    

---

âš¡ Example:

- BitLocker (Windows disk encryption) â†’ relies on **TPM**.
    
- Apple Pay or Face ID â†’ relies on **Secure Enclave**.


### ğŸ”‘ Secure Boot with TPM (simplified)

### 1. **Root of Trust**

- TPM has a **built-in, unchangeable root key** (burned at manufacturing).
    
- This acts like a â€œreference pointâ€ that canâ€™t be tampered with.
    

---

### 2. **Measuring boot process**

- As your PC starts, each stage of boot (firmware â†’ bootloader â†’ OS kernel â†’ drivers) is **measured**.
    
- â€œMeasuredâ€ = a **hash (digital fingerprint)** of the code is created.
    
- These hashes are sent to the TPM and stored in special registers called **PCRs (Platform Configuration Registers)**.
    

---

### 3. **Verification**

- The TPM compares the measured hashes with **known good values**.
    
- If even a single byte of the bootloader or firmware was modified (rootkit, bootkit, malware), the hash wonâ€™t match.
    
- TPM flags this as a **boot integrity failure**.
    

---

### 4. **Decision**

- If everything matches â†’ system boots normally.
    
- If not â†’ TPM refuses to release sensitive keys (like BitLockerâ€™s disk key), so the OS wonâ€™t boot encrypted data.
    

---

âœ… **Analogy:**  
Think of TPM like a **notary at the door**:

- Every guest (boot stage) must show their ID (hash).
    
- The notary checks IDs against a trusted list.
    
- If one ID is fake, they stop the party â†’ no one gets inside.
    

---

### ğŸ–¥ï¸ Real-world flow with BitLocker:

1. TPM checks BIOS/UEFI firmware hash.
    
2. TPM checks bootloader hash.
    
3. TPM checks OS kernel hash.
    
4. If all match trusted values â†’ TPM releases the BitLocker key â†’ Windows decrypts the drive â†’ system boots.
    
5. If mismatch â†’ TPM withholds the key â†’ you get a recovery screen instead.
    

---

ğŸ‘‰ So, **TPM ensures Safe Boot** by:

- Storing trusted baseline hashes.
    
- Measuring every boot stage.
    
- Refusing to unlock encryption keys if tampering is detected.

